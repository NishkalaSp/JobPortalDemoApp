
@{
    ViewBag.Title = "Search";
}

<h2>Search</h2>

<div>
    <div class="input-group">
        <input type="text" placeholder="Search by name.." id="search-box" class="form-control" />
        <span class="input-group-addon" style="width: 0;">
            <i class="glyphicon glyphicon-search"></i>
        </span>
    </div>

    <div id="searchResultContainer" style="display:none;">
        <h4>Search Results:</h4>
        <table id="searchTable" class="table">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>FullName</th>
                    <th>Email</th>
                    <th>Contact Number</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

@section scripts{
    <script src="~/Scripts/DataTables/jquery.dataTables.min.js"></script>

    <script>
        var searchBox = $("#search-box");
        var searchResultContainer = $("#searchResultContainer");
        var searchTable = $("#searchTable");
        var searchGrid;

        $("#search-box").on("keyup", function () {
            var searchText = searchBox.val();

            if (!searchTable.hasClass("dataTable")) {
                createDataTable();
            }
            else {
                searchGrid.fnDraw();
            }
            
            searchResultContainer.show();
            return false;
        });

        var createDataTable = function () {

            searchGrid = searchTable.dataTable({
                "sDom": '',
                "ajax": {
                    "url": "/Job/GetGridData",
                    "type": "GET",
                    "datatype": "json",
                    "data": { "searchString": searchBox.val() }
                },
                "serverSide": true,
                "searching": false,
                //"serverParams": function (aoData) {
                //    aoData.push({ "name": "searchString", "value": searchBox.val() });
                //  
                //},
                "columns": [
                    { "data": "Id", "autoWidth": "true" },
                    { "data": "FullName", "autoWidth": "true" },
                    { "data": "Email", "autoWidth": "true" },
                    { "data": "ContactNumber", "autoWidth": "true" },
                    {
                        "data": "DownloadUrl", "autoWidth": "5%", "mRender": function (row, type, data) {
                            return "<a href = " + data.DownloadUrl + "><i class='glyphicon glyphicon-download'></i></a>";
                        }
                    },
                    {
                        "data": "DetailsUrl", "autoWidth": "5%", "mRender": function (row, type, data) {
                            return "<a href = " + data.DetailsUrl + " target='_blank'><i class='glyphicon glyphicon-eye-open'></i></a>";
                        }
                    }
                ]
            });
        };

    </script>
    
}

